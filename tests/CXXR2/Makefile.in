# Low-level tests for the CXXR classes.

uname = $(shell uname)

top_builddir = ../..

top_srcdir = ../..

R = $(top_builddir)/bin/R --vanilla --quiet
RDIFF = $(top_builddir)/bin/R CMD Rdiff
REXEC= $(top_builddir)/bin/exec/R
FIND = \[1\] \"/home/arr/NOTBACKEDUP/sandboxes/CXXR1/trunk/library/stats\"
REPLACE = `echo 'attr(as.environment(\"package:stats\"), \"path\")' | $(R) | sed -n 2p`

include $(top_builddir)/Makeconf

tests = miscR xml_s11n

check : $(tests:=.ts)

miscR.ts : $(REXEC) misc.R misc.save
	$(R) < misc.R > misc.Rout 2>&1
	diff misc.save misc.Rout
	rm misc.Rout
	touch $@

xml_s11n.ts : $(REXEC) xml_serialize.R xml_deserialize.R xml_s11n.save
	rm -f bserialize.xml
	$(R) < xml_serialize.R
	$(R) < xml_deserialize.R > xml_s11n.fail
	sed -e "s|$(FIND)|$(REPLACE)|g" xml_s11n.save | $(RDIFF) - xml_s11n.fail 1
	rm -f bserialize.xml xml_s11n.fail
	touch $@

Makefile : Makefile.in
	cp $< $@

clean:
	rm -f *.ts

distclean: clean
	rm -f Makefile

include $(depends)
